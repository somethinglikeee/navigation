## 三维点云基础

1.点云数据介绍
点云是一个数据集，数据集中的每个点代表一组X、Y、Z几何坐标和一个强度值，这个强度值根据物体表面反射率记录返回信号的强度。当这些点组合在一起时，就会形成一个点云，即空间中代表3D形状或对象的数据点集合。主要特征如下：
Ø    密度不均匀（稀疏性）
Ø    不规则
Ø    没有纹理信息（三人成车）
Ø    对深度学习的特点：无序性，旋转不变性

2.点云主成分分析

2.1 维度缩减，将点云投影到二维，从而使点云被更好的分类

2.2 表面法向量的估计 

点云拟合曲面的切面的法向量，只有定义邻域才有法向量，邻域大相对平滑受个别点的影响小，邻域大比较灵敏但容易受影响。法向量是最没用的向量，所有点投影到这个向量上的值加起来最小，反应最少的特征。法向量估计可以应用到点云分割、聚类、平面点检测、作为点云的一个特征。

3.点云滤波

### 对于点云的密度进行处理？（体素滤波）？

3.1 噪点去除 

去除点云中的离散点

两种方法：

Radius Outlier Removal

Statistical Outlier Removal

3.2 下采样

对于点云的密度进行降低 保证点云的整体特征不变

- #### Voxel Grid Downsampling

核心思想，将点用体素内少量的中心点代替表示。
两种选点方式：1. 一个格子中计算平均点 2. 一个格子中随机选一个点


- #### Farthest Point Sampling

核心思想：挑一个点距离最远的点


- #### Normal Space Sampling

核心思想：保留特征突变的点，不会漏掉特征。适用于点云对齐


- #### Learning to Sampling

核心思想：传统方法通过几何关系找到降采样点，S-NET是根据语义关系，即经过降采样之后的点云输入网络还是能够得到同样的标签。设定几何约束，来使降采样的点与原来的点云距离相似。


3.3 上采样

### 点云上采样 将低密度点云转换为高密度的点云的一种操作，  在rm'赛程上似乎暂时用不到  对于点云密度的要求并不高

点云上采样通常有两种方法：

基于重构的方法：这种方法通过对点云进行重构（如曲面重构、体素网格化等），生成更密集的点云。

基于插值的方法：这种方法通过对原始点云中的点进行插值（如最近邻插值、高斯过程插值等），生成新的点，从而增加点云的密度。

点云上采样的应用场景包括但不限于：医学图像处理、机器人视觉、三维重建等领域。

4. #### 点云最邻近问题

  在SLAM中常会遇见点云的特征点匹配这类问题，如何寻找最邻近点成为了主要问题。

点云最邻近问题难点：1. 不规则  2. 三维  3. 数据量大
最邻近问题算法一般流程： 1. 分隔空间  2. 搜索空间  3. 停止搜索

算法主要分为点云储存和搜寻两个主要算法

一  点云搜索


二 点云存储

主要涉及二叉树以及其他的数据结构存储  暂时不深入探究

## 5. 点云聚类

（代码lidar_slam_course/ch2/point_cluster）
把相似的放在一起


### 5.1 K-Means算法

1、人工给定K个类  2、每个点是哪一个类  3、更新中心点的位置  4、迭代直到算法收敛
算法收敛的条件： 1、中心点不再移动  2、所有点分配点不再变化

### 5.2 K-Medoids

K-means对于有噪声存在的点效果不好。K-Medoids不再选平均值，而是选择一个点使得所有点的距离和最小。

### 5.3 高斯GMM模型

用高斯模型来描绘每个类的，给出每个点是该类的概率n个高斯模型的线性组合

### 5.4 Spectral Clustering 谱聚类 

之前的点是在欧式空间中聚类的，所以对于不规则的分布效果不好。谱聚类是根据点与点之间的连接性。利用点与点之间的关系建立相似度矩阵，求出其特征向量，利用每个点的特征向量进行K-Means聚类。计算点与点之间的相似度。

### 5.5 Mean Shift聚类

核心思想：一堆点，怎样让一个固定半径的圆尽可能的包含较多的点。将圆的中心随便放在一个位置坐标，计算所包含所有点的平均坐标，圆的中心再移动到平均坐标，再次计算包含所有点的平均坐标，如此重复，直到点中心坐标不再改变为止。 其结果并不是最优的。输入只需要设定圆的半径，并不需要设定多少类，自动去发现。（爬山思想）

### 5.6 DBSCAN

核心思想：水漫金山，基于点与点连接，只要能够连接到就是一类

六 点云拟合

### 6.1 最小二乘法

最小二乘方法，即通过最小化误差的平方和寻找数据的最佳函数匹配，最小二乘得到的是针对所有数据的全局最优，但是并不是所有数据都是适合去拟合的。

6.2 RANSAC随机抽样一致算法
采用迭代的方式从一组包含离群（outlier或者错误数据）的被观测数据中估算出数学模型的参数，相比最小二乘方法，它融合了剔除不合格数据的思想，因此对于有部分错误数据的数据样本，能够更快更准的给出辨识结果。用于三维点云处理中的模型提取，比如直线、球、圆柱、平面等的拟合与分割。

7. ### 点云特征点提取与描述

  特征点的数量相比于原始点云或图像的数据量减小很多，与局部特征描述子结合在一起，组成特征点描述子常用来形成原始数据的表示，而且不失代表性和描述性，从而加快了后续的识别，追踪等对数据的处理了速度，特征点技术成为在2D和3D 信息处理中非常关键的技术。关键点检测往往需要和特征提取联合在一起，关键点检测的一个重要性质就是旋转不变性。

## 8  点云匹配  （重点  用于重定位）



8.1 ICP基于距离
ICP通过迭代的方式，通过优化相对位姿，不断减小两帧点云之间点到点的距离，直到迭代收敛，最终计算出两帧点云的相对位姿。首先找到两组点云之间的对应问题，在ICP里面找最邻近的点，强行得到R，t，点一开始显然是不对的，但这是一个迭代的过程，直到R，t变化很小。可以用IMU来得到初始化的R，t。

ICP改进：
①　减少点
不用所有的点做ICP
对点云下采样
Normal Space Sampling（NSS）
②　数据关联
最邻近搜寻
Normal shooting：适用与平滑的点云
Projection
Feature descriptor matching
③　去除噪点
去除远距离
去除不匹配的点
④　Loss function
Point-to-point
point-to-plane
点到最邻近点平面的距离，point-to-point可能会强行对应点，point-to-plane收敛更快。LOAM 

点云ICP算法的优点包括：

算法简单易懂，易于实现和理解；
对于初始位姿估计较为准确的情况下，配准精度较高。
点云ICP算法的缺点包括：

对于大规模点云数据，算法的时间和空间复杂度较高，难以实现实时处理；
对于初始位姿估计不准确或存在环路等情况时，算法易受局部极小值的影响，可能导致配准失败或者配准精度较低。

2 NDT高斯重定位方法

### 基于概率 

NDT是将参考点云转换成多维变量的正态分布来进行配准。以一个格子一个格子为单位，找点落在哪个格子，格子里面的信息是一个高斯模型来描述点云的分布。

 NDT缺点：格子参数最重要，太大导致精度不高，太小导致内存过高，并且只有两幅图像相差不大的情况才能匹配。
改进：
①　八叉树建立，格子有大有小 ，迭代，每次使用更精细的格子
②　K聚类，有多少个类就有多少个cell，格子大小不一
③　三线插值 平滑相邻的格子cell导致的不连续，提高精度

NDT算法的优点包括：

算法不受初始位姿的影响，配准精度较高；
对于大规模点云数据，算法的时间和空间复杂度较低，适合实现实时处理。
NDT算法的缺点包括：

对于运动过程中，点云数据的变形和变化较大的情况下，算法的配准精度较低；
算法对点云数据的密度和分布有一定的要求，需要较为均匀和连续的点云数据才能达到较好的配准效果。



##### 点云配准步骤上可以分为粗配准和精配准 两个阶段

##### **粗配准**是指在点云**相对位姿完全未知**的情况下对点云进行配准，找到一个可以让两块点云相对近似的旋转平移变换矩阵，进而将待配准点云数据转换到统一的坐标系内，可以为精配准提供良好的初始值。

#####  精配准是指在粗配准的基础上，让点云之间的空间位置差异最小化，得到一个更加精准的旋转平移变换矩阵。该算法的运行速度以及向全局最优化的收敛性却在很大程度上依赖于给定的初始变换估计以及在迭代过程中对应关系的确立。所以需要各种粗配准技术为ICP算法提供较好的位置，在迭代过程中确立正确对应点集能避免迭代陷入局部极值，决定了算法的收敛速度和最终的配准精度。

ICP算法原理：给定一个参考点集P PP和一个数据点集Q QQ（在给定的初始估计R RR，t tt），算法为Q QQ中的每个点寻找P PP中对应的最近点，形成匹配点对。然后，将所有匹配点对的欧氏距离之和作为待求解的目标函数，利用奇异值分解求出R RR和t tt以使目标函数最小，根据R RR, t tt转换得到新的Q ′ ，并再次找到对应的点对，如此迭代。