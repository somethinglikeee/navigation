# 导航学习历程



/*  2024 10.04  */

  开始逐步实现  

1.先保存pcd地图

之后使用PCL库进行点云下采样  VoxelGrid滤波器 生成octomp八叉树地图

2.体素滤波后 进行点云特征点提取以及描述

### （学习pcl库）

#### 有先验地图的情况下：

对于点云数据处理目前的思路 ：1. 3d雷达获取全局点云数据地图  

2.对于点云数据进行体素滤波

3.对于滤波后的数据再次进行点云特征点提取

4.对于处理后的点云数据进行点云分割出地面区域（可到达区域）

导航：对于点云数据进行处理成八叉树地图？

之后使用amcl+icp重定位算法不断进行重定位

navigation全局导航   teb规划器 （伪车头？）


/*  2024 10.05  */
继续进行点云的预处理
到达点云最邻近问题

1.对之前处理过的pcl下采样点云数据进行点云特征点采样

2.继续生成八叉树地图（在线生成方式）

3.生成三维栅格地图 和二维栅格地图

4.尝试对三维栅格地图和二维栅格地图进行处理实现应用于导航中

5.接着学习pcl库（点云配准ICP相关）

6.学习点云分割（这个和八叉树地图的二维栅格地图有什么区别？）

7.学习gazebo实现仿真3d雷达建图并且获得rmuc2023地图的点云数据并进行点云数据处理


### 关于点云最邻近问题：
1.KDTree二叉树
2.OCTree八叉树
两种数据结构，通常对于三维点云数据使用八叉树更加适合

### 关于点云特征点提取问题
使用NARF方法：NARF关键点检测器结合点云的边界特征和法线方向来检测关键点。
    主要步骤包括：
        将点云转换为深度图像（Range Image）。
        提取深度图像的边界信息。
        基于边界信息和法线方向，检测具有显著特征的关键点。
### 关于点云滤波
使用离群点滤波
![输入图片说明](2024-10-05%2014-09-04%20%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png)

实现了使用mid360 fast_lio进行建图同时对点云进行预处理并得到二维栅格地图

接下来探索 icp 点云匹配 以及如何在有先验地图的基础上不再扩张性建图,还有对于离群滤波的参数整定问题

目前得到的只有2维的地图，未来考虑如何在z轴上拓展操作空间

还有fast_lio似乎只有10hz的更新频率，后面会尝试fast_lio2以及point_lio查看如何加快速度



/* 2024 10.06 */

查看实现构建二维栅格地图以及3d筛选点云的launch文件以及fast_lio具体内容，查看点云分割内容，以及对于点云的预处理是否有效，以及预处理的过程放置位置

学习gazebo实现仿真3d雷达建图并且获得rmuc2023地图的点云数据并进行点云数据处理，并得到二维栅格地图

使用rosbag记录建图过程，使用rosbag录制一下雷达的话题（imu+pcd）,这样就算建图效果一般，也能离线重新rosbag play进行建图。

关于icp的点云匹配重定位问题似乎有更好的点云下采样方法，VoxelGrid体素栅格滤波似乎会降低采样精度，可以使用NSS（normal space sampling）进行尝试，查看icp点云配准的效

率以及精度，体素栅格滤波对于点云的降采样似乎更加效率化，但对于点云的特征点丢失较为严重。 对于NSS，对于点云的特征点的保留较好，NSS是直接对于点云数据的法向量特征进行

分类并降采样，而体素栅格滤波是统一的对于点云数据进行压缩。

测试ICP对这两种滤波方法的适应性，（动态&静态）

尝试将点云的预处理阶段写成一个完成的launch文件以及icp点云匹配的launch文件。



/* 2024 10.07 */

继续查看fast_lio_locationlaunch文件内容

以及关于ICP重定位point to point  以及point to plane对什么因素敏感？

实现使用rosbag记录建图过程，使用rosbag录制一下雷达的话题（imu+pcd）,这样就算建图效果一般，也能离线重新rosbag play进行建图。

并编写完整的点云获取，构建二维栅格地图，保存后在先验地图上进行二次建图，获取代价地图，至此基本实现进行路径规划前的建图流程


![输入图片说明](%E7%82%B9%E4%BA%91%E7%AE%97%E6%B3%95/Readme.md0c3f519275fa201c56c1ce6e727e0a1f.JPG)
![输入图片说明](%E7%82%B9%E4%BA%91%E7%AE%97%E6%B3%95/Readme.md5046c4385387a61662cabb4c0926d234.JPG)

/* 2024 10.08 */

目前使用二维栅格地图格式使用navigation+dwa局部规划器进行导航，仿真路径效果还可以，

对于重定位问题，在摇晃和旋转强度不高时 icp匹配和重定位效果还好，但是如果偏差比较大时，比如初值偏移量过大会匹配失败，无法收敛，寻求优化方法，

重定位暂时不用里程计

后面尝试使用teb 人工势场等其他局部规划器

学习DWA TEB算法原理 使用matlab仿真模拟调参

##### 目前的问题：

对于pointcloud2 to laserscan 得到的是一张基于当前

雷达z轴高度的2d栅格地图，对于比雷达z轴高度低的地方无法获得

障碍物信息，鉴于rm的比赛要求，雷达安放在适宜的高度基本可以

适应所有的避障和导航。未来可以上实车进行测试。

##### 后面的规划：  

###### 点云处理：

使用点云分割，使用linefit_ground_segmentation

对MID360的点云进行分割，分割为地面和障碍物，可以获得地面上

的障碍物，再使用点云分割的点云转为laser_scan 再输入

navigation所需要的信息。

###### 重定位：

ICP在初值较好的情况下配准较好  再尝试其他GICP等算法，以及对于点云的预处理能不能有其他改进



##/*  2024 10.14  */
部署完毕之前的完整导航
尝试使用轨迹跟踪算法，对局部规划器得到的路径进行pid+前馈路径跟踪并得到速度信息，在轨迹跟踪模块中，读取全局路径规划模块中的全局路径，根据前视距离参数取一段路径，使用贝塞尔曲线进行轨迹平滑，然后使用位置pid进行轨迹跟踪，准备角速度映射，实现了小陀螺过程中导航。

全局路径规划发现了一种A*的变种  theta A*全局路径规划  

todo 先测试目前部署的导航算法


## /* 2024 10.16  */

dwa调参经验：
https://focallog.com/article/6a1ab439-c19c-430a-98e3-09ec7aa6df49
一般更新频率限制在20hz-25hz

## /* 2024 10.22 */

对于雷达和下位机c板的陀螺仪进行tf坐标转换，找到角度，雷达相对于陀螺仪的角度（yaw轴陀螺仪比雷达大120度）

## /* 2024 10.23 */

接下来着重优化icp算法，以及点云处理

## /* 2024 10.24 */

着重查看icp算法

经过测试发现，对于目标点云（先验点云）需要进行体素滤波和离群滤波，雷达点云无需进行处理，这样会大大提高配准效率，

对启动时如果icp的初值不好的情况下，可以对目标点云进行旋转遍历360度，对每个角度都进行icp配准并且评分，找到评分最低（也就是最佳角度）之后保存yaw角度

将目标点云旋转至这个yaw角度，并且之后定时相对这个点云进行配准

## /* 2024 10.26 */

对于icp的更新优化

对雷达的实时点云存储为pcd文件，与先验点云配准

对gicp ndt icp都进行了测试，gicp的配准效率大概为icp的1.5倍，且精准度较高

icp在经过kdtree的优化后显示出更高的效率

todo

累积多次的雷达实时点云存储，单次的实时点云配准效率不高

对现有自编写icp优化逻辑

## /*2024 10.27 */

对保存雷达点云，进行多次保存，之后对其进行体素滤波和离群点滤波等处理，来实现寻优角度

基本实现了寻找最优icp匹配角度

## /*2024 10.30 */
实现了手写的点云配准逻辑，之后对其进行逻辑优化

进入路径规划优化阶段

## /*2024 11.1 */
icp基本实现迅速配准，之后继续维护优化

对于路径规划，发现车体对于先验预测路径响应不快

### TODO

使用TEB规划器

实现导航时自身旋转